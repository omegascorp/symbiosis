/*
 * LighEdit 0.1.5
 * lighedit.omegascorp.net
 */
(function(a){a.fn.lightedit=function(b){var c=[];a(this).each(function(){void 0==a(this).data("lightedit")?c.push(new h(a(this),b)):c.push(a(this).data("lightedit"))});return c};a.fn.lighteditGet=function(){return a(this).eq(0).data("lightedit").get()};a.lightedit=function(){return a(".lightedit.lightedit-current").data("lightedit")};var j={full:function(b){b.hasClass("lightedit-active")?(a("html,body").css("overflow","auto"),b.removeClass("lightedit-active"),this.element.removeClass("lightedit-full"),this.element.css({height:"auto",width:"auto"}),void 0!=this.scroll&&(a(window).scrollLeft(this.scroll[0]),a(window).scrollTop(this.scroll[1]))):(this.scroll=[a(window).scrollLeft(),a(window).scrollTop()],a("html,body").css("overflow","hidden"),b.addClass("lightedit-active"),this.element.addClass("lightedit-full"),outerVertical=parseInt(this.element.css("padding-top"))+parseInt(this.element.css("padding-bottom")),outerHorizontal=parseInt(this.element.css("padding-left"))+parseInt(this.element.css("padding-right")),this.element.css({width:a(window).width()-outerHorizontal+"px",height:a(window).height()-outerVertical+"px"}),a(window).scrollLeft(0),a(window).scrollTop(0));this.updateToolbar()},html:function(b){b.hasClass("lightedit-active")?(b.removeClass("lightedit-active"),this.element.find(".lightedit-text").each(function(){a(this).find("iframe").show();a(this).find("textarea").hide()}),this.updateHtml()):(b.addClass("lightedit-active"),this.element.find(".lightedit-text").each(function(){a(this).find("iframe").hide();a(this).find("textarea").show().height(a(this).find("iframe").height())}),this.updateText());a(".lightedit").each(function(){a(this).data("lightedit").updateToolbar()})},"table-insert-row-top":function(){var b=this.current.doc.find("table td.lightedit-active").parent().find("td").length,c=a("<tr></tr>");for(i=0;i<b;i++)c.append("<td><br/></td>");this.current.doc.find("table td.lightedit-active").parent().before(c);this.current.update();this.current.updateHeight();this.current.historySave()},"table-insert-row-bottom":function(){var b=this.current.doc.find("table td.lightedit-active").parent().find("td").length,c=a("<tr></tr>");for(i=0;i<b;i++)c.append("<td><br/></td>");this.current.doc.find("table td.lightedit-active").parent().after(c);this.current.update();this.current.updateHeight();this.current.historySave()},"table-insert-col-left":function(){var b=this.current.doc.find("table td.active").index();this.current.doc.find("table td.active").closest("table").find("tr").each(function(){a(this).find("td").eq(b).before("<td><br/></td>")});this.current.update();this.current.updateHeight();this.current.historySave()},"table-insert-col-right":function(){var b=this.current.doc.find("table td.lightedit-active").index();this.current.doc.find("table td.lightedit-active").closest("table").find("tr").each(function(){a(this).find("td").eq(b).after("<td><br/></td>")});this.current.update();this.current.updateHeight();this.current.historySave()},"table-delete-row":function(){this.current.doc.find("table td.lightedit-active").parent().remove();this.current.update();this.current.updateHeight();this.current.historySave()},"table-delete-col":function(){var b=this.current.doc.find("table td.lightedit-active").index();this.current.doc.find("table td.lightedit-active").closest("table").find("tr").each(function(){a(this).find("td").eq(b).remove()});this.current.update();this.current.updateHeight();this.current.historySave()},"table-delete":function(){this.current.doc.find("table td.lightedit-active").closest("table").remove();this.current.update();this.current.updateHeight();this.current.historySave()}},h=function(b,c){this.element=b;this.options=c=a.extend({base:"",path:"",toolbar:"default",styles:"default",language:"en",height:b.height()?b.height():100,formating:"formating.js","plugin-image":{upload:"files/lightedit/plugins/upload.php",images:"files/lightedit/plugins/images.php"},top:0,save:function(){this.parent.element.find(".lightedit-saved").fadeOut();return!0},hidden:!1},c);a("base").length&&!this.options.base&&(this.options.base=a("base").attr("href"));a("script").each(function(){var b=a(this).attr("src");if(b){var e=RegExp(/js\/jquery.lightedit(\.min)?\.js(\?.*)?/);b.match(e)&&(c.path=b.replace(e,""))}});this.language=[];this.toolbar=[];this.styles=[];this.current=null;this.data={};this.top=0;this.init()};h.prototype={init:function(){var b=0;a(".lightedit").each(function(){void 0!=a(this).data("lightedit")&&b++});0==b&&this.element.addClass("lightedit-current");this.element.addClass("lightedit");this.element.data("lightedit",this);this.element.find("textarea").each(a.proxy(function(b,d){new l(this,a(d),0==b?!0:!1)},this));this.element.find(".lightedit-tabs").length?(this.element.find(".lightedit-tab").hide().first().show(),this.element.find(".lightedit-tabs").after('<div class="lightedit-nav"><ul></ul></div>'),this.element.find(".lightedit-tab").each(a.proxy(function(b,d){this.element.find(".lightedit-nav ul").append('<li><a href="">'+a(d).attr("data-title")+"</a></li>")},this)),this.element.find(".lightedit-nav li:first").addClass("lightedit-current"),this.element.find(".lightedit-nav a").click(a.proxy(function(b){b=a(b.currentTarget);var d=b.parent().index();this.element.find(".lightedit-tab").hide().find(".lightedit-text.lightedit-current").removeClass("lightedit-current");this.element.find(".lightedit-tab").eq(d).show().find(".lightedit-text:first").addClass("lightedit-current");this.element.find(".lightedit-nav li").removeClass("lightedit-current");b.parent().addClass("lightedit-current");a(".lightedit").each(function(){a(this).data("lightedit").updateToolbar()});return!1},this))):this.element.append('<div class="lightedit-nav"></div>');this.element.find(".lightedit-nav").append('<div class="lightedit-saved" style="display:none;">Saved</div>');this.element.find("input[type=text]").wrap('<div class="lightedit-input-container">');this.element.find("input[type=text]").wrap('<div class="lightedit-input">');this.element.find(".lightedit-input-container").each(function(){var b=a(this).find("input").attr("title");a(this).prepend("<label>"+b+"</label>")});this.element.append(a('<div class="lightedit-dropdown" style="display: none;"></div>'));this.element.append(a('<div class="lightedit-overlay" style="display: none;"></div>'));this.element.append(a('<div class="lightedit-dialog" style="display: none;"></div>'));this.element.find(".lightedit-overlay").click(a.proxy(function(){this.dialogClose()},this));this.load([this.options.path+"languages/"+this.options.language+".json",this.options.path+"toolbars/"+this.options.toolbar+".json",this.options.path+"styles/"+this.options.styles+".json"],["language","toolbar","styles"],function(){var b=a('<div class="lightedit-toolbar"><ul></ul></div>');b.after('<div class="lightedit-toolbar-left"></div>');b.after('<div class="lightedit-toolbar-right"></div>');b.after('<div class="lightedit-toolbar-popup" style="display:none;"><div class="lightedit-toolbar-popup-tailtop"></div><div class="lightedit-toolbar-popup-content"></div><div class="lightedit-toolbar-popup-tail"></div></div>');for(key in this.toolbar){var d=this.toolbar[key],e=a('<li><a href="" data-title="'+this.language[d.title]+'"></a></li>');e.addClass("lightedit-tool-"+d.title);!0==d.separator&&e.addClass("lightedit-separator");void 0!=d.screen&&e.addClass("lightedit-screen-"+d.screen);void 0!=d.align&&e.addClass("lightedit-align-"+d.align);if(d.exec)e.find("a").data("exec",d.exec),e.find("a").data("param",void 0!=d.param?d.param:null);else if(void 0!=d.func)e.find("a").data("function",d.func);else if(d.dropdown){dropdown=a("<ul></ul>");for(k in d.dropdown)v=d.dropdown[k],f=a('<li><a href=""></a></li>'),f.addClass("lightedit-tool-"+v.title),void 0!=v.exec?(f.find("a").html(this.language[v.title]),f.find("a").data("exec",v.exec),f.find("a").data("param",void 0!=v.param?v.param:null)):void 0!=v["class"]?(f.find("a").html(v.title),f.find("a").data("exec","class"),f.find("a").data("param",v["class"])):void 0!=v.func?(f.find("a").html(this.language[v.title]),f.find("a").data("function",v.func)):void 0!=v.plugin&&(f.find("a").html(this.language[v.title]),f.find("a").data("plugin",v.plugin)),!0==v.separator&&f.addClass("lightedit-separator"),dropdown.append(f);dropdown.hide();e.append(dropdown)}else d.plugin&&e.find("a").data("plugin",d.plugin);e.children("a").hover(function(){var b=a(this).closest(".lightedit").data("lightedit"),c=a(this).closest(".lightedit").find(".lightedit-toolbar-popup");c.find(".lightedit-toolbar-popup-content").html(a(this).attr("data-title"));var d=a(this).offset(),e=d.left-c.width()/2+a(this).width()/2;e<a(window).scrollLeft()?(c.find(".lightedit-toolbar-popup-tail").css("background-position",d.left+5+"px -8px"),c.find(".lightedit-toolbar-popup-tailtop").css("background-position",d.left+5+"px 0"),e=5):e+c.width()>a(window).scrollLeft()+a(document).width()&&(e=a(window).scrollLeft()+a(document).width()-c.width()-5,c.find(".lightedit-toolbar-popup-tail").css("background-position",d.left-e+8+"px -8px"),c.find(".lightedit-toolbar-popup-tailtop").css("background-position",d.left-e+8+"px 0"));var f=0;d.top>a(window).scrollTop()+b.options.top+c.height()?(c.find(".lightedit-toolbar-popup-tailtop").hide(),c.find(".lightedit-toolbar-popup-tail").show(),f=d.top-c.height()):(c.find(".lightedit-toolbar-popup-tail").hide(),c.find(".lightedit-toolbar-popup-tailtop").show(),f=d.top+a(this).height());c.css({left:e+"px",top:f+"px"}).show()},function(){var b=a(this).closest(".lightedit").find(".lightedit-toolbar-popup");b.hide();b.find(".lightedit-toolbar-popup-tail").css("background-position","50% -8px");b.find(".lightedit-toolbar-popup-tailtop").css("background-position","50% 0")});e.find("a").click(function(){a(".lightedit-dropdown").hide();var b=a(this).closest(".lightedit").data("lightedit"),c=a(this).closest(".lightedit").find(".lightedit-text.lightedit-current").data("lightedit-text");a(".lightedit").removeClass("lightedit-current");b.element.addClass("lightedit-current");void 0!=c&&(void 0!=a(this).data("exec")?c.exec(a(this).data("exec"),a(this).data("param")):void 0!=a(this).data("plugin")?(b=a(this).data("plugin"),c.plugin(b)):void 0!=a(this).data("function")?(b=a(this).data("function"),c.func(b,this)):a(this).parent().find("ul").length&&(b.element.find(".lightedit-dropdown").html("").css({left:a(this).offset().left,top:a(this).offset().top}),b.element.find(".lightedit-dropdown").append(a(this).parent().find("ul").clone(!0).show()).show()));return!1});b.children("ul").append(e)}e=a("<ul></ul>");for(key in this.styles.classes){var d=this.styles.classes[key],f=a('<li class="'+d+'"><a href="">'+d+"</a></li>");f.click(a.proxy(function(b){a(".lightedit-dropdown").hide();this.current.exec("class",b);return!1},this,d));e.append(f)}f=a('<li><a href="">'+this.language["class-remove"]+"</a></li>");f.click(a.proxy(function(){a(".lightedit-dropdown").hide();a.proxy(this.current.exec,this.current,"removeClass")();return!1},this,d));e.append(f);b.find(".lightedit-tool-class").append(e);this.element.prepend(b);this.updateToolbar();this.element.find(".lightedit-toolbar-left,.lightedit-toolbar-right").hide();this.element.find(".lightedit-toolbar").mousemove(function(b){var c=a(this).closest(".lightedit").data("lightedit");b=b.pageX-a(this).offset().left;var d=a(this).width();50>b&&0!=a(this).scrollLeft()?c.element.find(".lightedit-toolbar-left").show().css("opacity",0.1*(50-b)):c.element.find(".lightedit-toolbar-left").hide();50>d-b&&a(this).scrollLeft()+d<a(this).children("ul").width()?c.element.find(".lightedit-toolbar-right").show().css("opacity",0.1*(50-d+b)):c.element.find(".lightedit-toolbar-right").hide()});this.element.find(".lightedit-toolbar-left,.lightedit-toolbar-right").hover(function(){a(this).addClass("lightedit-over")},function(){a(this).removeClass("lightedit-over")});this.options.hidden&&this.hide()});this.dialogUpdate();this.element.scroll(a.proxy(function(){this.updateToolbar();this.updateDialog();a(".lightedit-dropdown").hide()},this));setInterval(a.proxy(function(){this.top!=this.element.offset().top&&(this.updateToolbar(),this.top=this.element.offset().top)},this),50)},load:function(b,c,d){b.length?a.get(b.shift(),a.proxy(function(b){this[0][c.shift()]=b;a.proxy(this[0].load,this[0],this[1],this[2],this[3])()},[this,b,c,d])):a.proxy(d,this)()},updateHtml:function(){this.element.find(".lightedit-text").each(function(){a(this).data("lightedit-text").updateHtml()})},updateText:function(){this.element.find(".lightedit-text").each(function(){a(this).data("lightedit-text").updateText()})},updateToolbar:function(){var b=this.element.find(".lightedit-toolbar").outerWidth()-this.element.find(".lightedit-toolbar").width(),c=this.element.hasClass("full"),d=c?this.element.scrollTop():a(window).scrollTop(),e=this.element.find(".lightedit-tabs").width();e||(e=this.element.find("iframe:first").width());var f=this.element.find(".lightedit-text.lightedit-current").offset().top;c&&(f+=d);c=this.element.find(".lightedit-text.lightedit-current").height();this.element.find(".lightedit-toolbar").width(e-b);position=f-this.options.top>d?f:d<c+f?d+this.options.top:c+f;this.element.find(".lightedit-toolbar").css("top",position+"px");var b=this.element.find(".lightedit-toolbar").width(),g=0;this.element.find(".lightedit-toolbar>ul>li").each(function(){"none"!=a(this).css("display")&&(g+=a(this).outerWidth())});this.element.find(".lightedit-toolbar>ul").width(g);this.element.find(".lightedit-toolbar-left").css({top:position+"px"});this.element.find(".lightedit-toolbar-right").css({top:position+"px","margin-left":b-16+"px"});b<g?this.element.find(".lightedit-toolbar").addClass("scrollable"):this.element.find(".lightedit-toolbar").removeClass("scrollable")},dialogUpdate:function(){var b=a(document).height(),c=a("body").height();this.element.find(".lightedit-overlay").height(Math.max(b,c));var b=a(window).width(),c=a(window).height(),d=a(window).scrollTop(),e=a(this).find(".lightedit-dialog").outerWidth(),f=a(this).find(".lightedit-dialog").outerHeight();a(this).find(".lightedit-dialog").css({left:b/2-e/2+"px",top:d+c/2-f/2+"px"})},dialog:function(b){void 0==b&&(b={});b=a.extend({width:400,height:340,ajax:"",data:{},props:{}},b);this.element.find(".lightedit-dialog").width(b.width).height(b.height);var c=a(window).width(),d=a(window).height(),e=this.element.find(".lightedit-dialog").outerWidth(),f=this.element.find(".lightedit-dialog").outerHeight(),g=a(window).scrollTop();this.element.find(".lightedit-dialog").css({left:c/2-e/2+"px",top:g+d/2-f/2+"px"});this.element.find(".lightedit-dialog").show();this.element.find(".lightedit-overlay").fadeIn("fast");b.ajax&&(this.element.find(".lightedit-dialog").addClass("loading"),a.ajax({url:b.ajax,data:b.data,type:"POST",dataType:"html",success:a.proxy(function(a){this[0].data=this[1];var b=a.match(/\{[a-zA-Z\-]*\}/g);if(null!=b)for(key in b)val=b[key],label=val.substr(1,val.length-2),a=a.replace(RegExp(val,"g"),this[0].language[label]);this[0].element.find(".lightedit-dialog").removeClass("loading");this[0].element.find(".lightedit-dialog").html(a)},[this,b.props])}))},dialogClose:function(){this.element.find(".lightedit-overlay").fadeOut("fast");this.element.find(".lightedit-dialog").hide().removeClass("loading").html("")},exec:function(a,c){this.current.exec(a,c)},insert:function(a){this.current.exec("inserthtml",a)},get:function(){this.updateText();var b={};this.element.find(".lightedit-tab").length&&(b.languages={},this.element.find(".lightedit-tab").each(function(){var c={};a(this).find("input,textarea").each(function(){c[a(this).attr("name")]=a(this).val()});b.languages[a(this).attr("data-lang")]=c}));this.element.find("input,textarea").each(function(){0==a(this).closest(".lightedit-tab").length&&(b[a(this).attr("name")]=a(this).val())});return b},hide:function(){this.element.find(".lightedit-toolbar").hide();this.options.hidden=!0},show:function(){this.element.find(".lightedit-toolbar").show();this.options.hidden=!1}};var l=function(a,c,d){this.parent=a;this.element=c;this.history=[];this.index=-1;this.textarea=this.doc=this.iframe=null;this.init(d)};l.prototype={init:function(b){this.element.wrap('<div class="lightedit-text">');this.textarea=this.element;this.element=this.element.parent();this.element.data("lightedit-text",this);var c=this.parent.options;this.iframe=a('<iframe src="javascript:false;" frameborder="0" style="width:100%;"></iframe>');this.textarea.after(this.iframe);this.textarea.hide();this.doc=a(this.iframe.get(0).contentWindow.document);var c='<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><base href="'+c.base+'" /><link rel="stylesheet" href="'+c.path+'css/formating.css" type="text/css" media="screen" />STYLE_SHEET</head><body>INITIAL_CONTENT</body></html>',d=this.doc.get(0);d.open();d.write(c.replace(/INITIAL_CONTENT/,function(){return" "}).replace(/STYLE_SHEET/,function(){return"<style>body,html{overflow:hidden;}body:after{content: '.';display: block;clear: both;visibility: hidden;height: 0;}</style>"}));d.close();d.designMode="on";this.doc.click(a.proxy(function(){var b=this.parent.element;b.find(".lightedit-dropdown").hide();b.find(".lightedit-text").removeClass("lightedit-current");this.element.addClass("lightedit-current");this.parent.current=this;a(".lightedit").removeClass("lightedit-current");this.parent.element.addClass("lightedit-current");this.parent.updateToolbar()},this));this.doc.keyup(a.proxy(function(b){8==b.keyCode?(b=a(this).find("body").html(),("<br>"==b||"<br/>"==b||"<br />"==b||""==b||" "==b)&&this.execCommand("formatblock",!1,"<p>")):32==b.keyCode&&this.historySave();this.updateHeight()},this));this.doc.keydown(a.proxy(function(b){return b.ctrlKey&&90==b.keyCode?(this.historyPrev(),!1):b.ctrlKey&&89==b.keyCode?(this.historyNext(),!1):b.ctrlKey&&83==b.keyCode?(a.proxy(this.parent.options.save,this.parent,this.parent.get())()&&this.parent.element.find(".lightedit-saved").fadeIn(),!1):!0},this));b&&(this.element.addClass("lightedit-current"),this.parent.current=this,this.iframe.focus());this.history.push(this.textarea.val());this.index=0;this.updateHtml()},update:function(){this.doc.find("img").unbind("click").click(a.proxy(function(b){b=a(b.currentTarget);this.parent.dialog({ajax:this.parent.options.path+"plugins/image-edit.php",props:{image:b}});return!1},this));this.doc.find("a").unbind("click").click(a.proxy(function(b){b=a(b.currentTarget);this.parent.dialog({ajax:this.parent.options.path+"plugins/link.php",props:{link:b}});return!1},this));this.doc.find("table").unbind("hover").hover(function(){a(this).addClass("lightedit-over")},function(){a(this).removeClass("lightedit-over")}).find("td").unbind("click").click(function(){a(this).closest("body").find("td.lightedit-active,table.lightedit-active").removeClass("lightedit-active");a(this).closest("table").addClass("lightedit-active");a(this).addClass("lightedit-active");return!1});this.doc.find("span").unbind("click").click(function(){a(this).closest("body").find("span.lightedit-active").removeClass("lightedit-active");a(this).addClass("lightedit-active");return!1});this.doc.find(".grid-col").unbind("hover").hover(function(){a(this).addClass("lightedit-over")},function(){a(this).removeClass("lightedit-over")}).unbind("click").click(function(){a(this).closest("body").find(".grid-col").removeClass("lightedit-active");a(this).addClass("lightedit-active");return!1});this.doc.click(function(){a(this).find("td.lightedit-active,table.lightedit-active,.grid-col.lightedit-active,span.lightedit-active").removeClass("lightedit-active")})},updateHtml:function(){var b=this.element.find("textarea").val();if(""==b||"<br>"==b||"<br/>"==b)b="<p><br/></p>";a(this.element.find("iframe").get(0).contentWindow.document).find("body").html(b);this.update();this.updateHeight()},updateText:function(){this.element.find("textarea").val(a(this.element.find("iframe").get(0).contentWindow.document).find("body").html())},updateHeight:function(){var b=this.doc.find("body").outerHeight()+20;this.iframe.height(b>this.parent.options.height?b:this.parent.options.height);a(".lightedit").each(function(){a(this).data("lightedit").updateToolbar()})},exec:function(b,c){this.iframe.get(0).contentWindow.focus();"class"==b?(this.doc.get(0).execCommand("ForeColor",!1,"#00f001"),this.doc.find('font[color="#00f001"]').each(function(){text=a(this).html();a(this).replaceWith('<span class="'+c+'">'+text+"</span>")}),this.update()):"removeClass"==b?this.doc.find("span.lightedit-active").replaceWith(this.doc.find("span.lightedit-active").html()):this.doc.get(0).execCommand(b,!1,c);this.historySave();this.updateHeight();this.update()},insert:function(a){this.exec("inserthtml",a)},func:function(b,c){void 0!=j[b]&&a.proxy(j[b],this.parent,a(c).parent())()},plugin:function(a){this.parent.dialog({ajax:this.parent.options.path+"plugins/"+a+".php",data:this.parent.options["plugin-"+a]})},historySave:function(){this.index++;for(i=this.index;i<this.history.length;i++)delete this.history[i];this.history[i]=this.doc.find("body").html()},historyNext:function(){this.index+1>=this.history.length||(this.index++,this.doc.find("body").html(this.history[this.index]),this.update(),this.updateHeight())},historyPrev:function(){1>this.index||(this.index--,this.doc.find("body").html(this.history[this.index]),this.update(),this.updateHeight())},get:function(){this.updateText();return this.textarea.val()},set:function(a){this.textarea.val(a);this.updateHtml()}};a(document).click(function(){a(".lightedit-dropdown").hide()});a(window).scroll(function(){a(".lightedit").each(function(){a(this).data("lightedit").updateToolbar()});a(".lightedit-dropdown").hide()});a(window).resize(function(){a(".lightedit").each(function(){var b=a(this).data("lightedit");b.updateToolbar();b.dialogUpdate()});a(".lightedit-dropdown").hide();var b=parseInt(a(".lightedit.full").css("padding-top"))+parseInt(a(".lightedit.full").css("padding-bottom"));a(".lightedit.full").height(a(window).height()-b);b=parseInt(a(".lightedit.full").css("padding-left"))+parseInt(a(".lightedit.full").css("padding-right"));a(".lightedit.full").width(a(window).width()-b)});setInterval(function(){a(".lightedit-toolbar-left.lightedit-over").each(function(){var b=a(this).closest(".lightedit").find(".lightedit-toolbar"),c=b.scrollLeft();b.scrollLeft(c-10);c==b.scrollLeft()&&a(this).removeClass("lightedit-over").hide()});a(".lightedit-toolbar-right.lightedit-over").each(function(){var b=a(this).closest(".lightedit").find(".lightedit-toolbar"),c=b.scrollLeft();b.scrollLeft(c+10);c==b.scrollLeft()&&a(this).removeClass("lightedit-over").hide()})},100)})(jQuery);